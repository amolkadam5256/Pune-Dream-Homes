// backend/prisma/schema.prisma

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ENUMS ====================

enum Role {
  ADMIN
  CUSTOMER
  AGENT
}

enum PropertyType {
  FLAT
  HOUSE
  VILLA
  PLOT
  COMMERCIAL
  PG
  WAREHOUSE
  OFFICE
  SHOP
  SHOWROOM
}

enum PropertyStatus {
  READY_TO_MOVE
  UNDER_CONSTRUCTION
  NEW_LAUNCH
}

enum TransactionType {
  SALE
  RENT
  LEASE
  PG
}

enum FurnishingStatus {
  FULLY_FURNISHED
  SEMI_FURNISHED
  UNFURNISHED
}

enum PropertyApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  INACTIVE
}

enum FacingDirection {
  NORTH
  SOUTH
  EAST
  WEST
  NORTH_EAST
  NORTH_WEST
  SOUTH_EAST
  SOUTH_WEST
}

enum ParkingType {
  COVERED
  OPEN
  NO_PARKING
}

enum AvailabilityStatus {
  AVAILABLE
  SOLD
  RENTED
  RESERVED
}

enum ProjectStatus {
  UPCOMING
  ONGOING
  COMPLETED
  APPROVED
  RERA_APPROVED
}

// ==================== USER MANAGEMENT ====================

model User {
  id              String    @id @default(uuid())
  
  // Login & Authentication
  email           String    @unique
  password        String
  role            Role      @default(CUSTOMER)
  isVerified      Boolean   @default(false)
  isActive        Boolean   @default(true)
  
  // Basic Profile Information
  firstName       String?
  lastName        String?
  phone           String?
  profileImage    String?
  
  // Additional Profile Details
  dateOfBirth     DateTime?
  age             Int?
  gender          String?   // Male, Female, Other
  address         String?   @db.Text
  city            String?
  state           String?
  country         String?   @default("India")
  pincode         String?
  
  // Professional/Additional Info
  occupation      String?
  companyName     String?
  bio             String?   @db.Text
  website         String?
  
  // Preferences
  preferredLanguage String? @default("English")
  notificationEnabled Boolean @default(true)
  emailNotifications Boolean @default(true)
  smsNotifications Boolean @default(true)
  
  // Metadata
  lastLoginAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  properties      Property[]
  favorites       Favorite[]
  inquiries       Inquiry[]
  reviews         Review[]
  appointments    Appointment[]
  searches        SavedSearch[]
  agent           Agent?

  @@map("users")
}

model Agent {
  id              String    @id @default(uuid())
  userId          String    @unique
  agencyName      String?
  licenseNumber   String?
  experience      Int?      // in years
  specialization  String[]  // ["Residential", "Commercial", "Rental"]
  areasServed     String[]  // ["Pune", "Mumbai"]
  languages       String[]  // ["English", "Hindi", "Marathi"]
  rating          Float?    @default(0)
  totalReviews    Int       @default(0)
  totalDeals      Int       @default(0)
  successRate     Float?    // percentage
  isVerified      Boolean   @default(false)
  isPremium       Boolean   @default(false)
  availabilityStatus String @default("AVAILABLE") // AVAILABLE, BUSY, OFFLINE
  responseTime    Int?      // in minutes
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  properties      Property[]
  appointments    Appointment[]

  @@index([isVerified, isPremium])
  @@index([rating])
  @@map("agents")
}

// ==================== LOCATION MANAGEMENT ====================

model City {
  id              String    @id @default(uuid())
  name            String    @unique
  state           String
  country         String    @default("India")
  latitude        Float?
  longitude       Float?
  description     String?   @db.Text
  image           String?
  metaTitle       String?
  metaDescription String?   @db.Text
  isActive        Boolean   @default(true)
  isFeatured      Boolean   @default(false)
  propertyCount   Int       @default(0)
  averagePrice    Float?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  localities      Locality[]
  properties      Property[]
  projects        Project[]

  @@index([state])
  @@index([isFeatured])
  @@map("cities")
}

model Locality {
  id              String    @id @default(uuid())
  cityId          String
  name            String
  pincode         String?
  latitude        Float?
  longitude       Float?
  description     String?   @db.Text
  averagePrice    Float?
  pricePerSqft    Float?
  priceGrowth     Float?    // year-over-year percentage
  connectivity    String?   @db.Text
  aboutLocality   String?   @db.Text
  infrastructure  String?   @db.Text
  images          String[]
  videoUrl        String?
  isPopular       Boolean   @default(false)
  isTrending      Boolean   @default(false)
  propertyCount   Int       @default(0)
  metaTitle       String?
  metaDescription String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  city            City      @relation(fields: [cityId], references: [id], onDelete: Cascade)
  properties      Property[]
  projects        Project[]
  nearbyPlaces    NearbyPlace[]

  @@unique([cityId, name])
  @@index([isPopular, isTrending])
  @@index([pricePerSqft])
  @@map("localities")
}

model NearbyPlace {
  id              String    @id @default(uuid())
  localityId      String
  name            String
  category        String    // School, Hospital, Mall, Metro, Airport, etc.
  distance        Float     // in kilometers
  travelTime      Int?      // in minutes
  rating          Float?
  description     String?
  createdAt       DateTime  @default(now())

  // Relations
  locality        Locality  @relation(fields: [localityId], references: [id], onDelete: Cascade)

  @@index([localityId, category])
  @@map("nearby_places")
}

// ==================== PROPERTY MANAGEMENT ====================

model Property {
  id                    String                  @id @default(uuid())
  userId                String
  agentId               String?
  projectId             String?
  cityId                String
  localityId            String

  // Basic Info
  title                 String
  slug                  String?                 @unique
  description           String                  @db.Text
  propertyType          PropertyType
  transactionType       TransactionType
  status                PropertyStatus
  approvalStatus        PropertyApprovalStatus  @default(PENDING)
  availabilityStatus    AvailabilityStatus      @default(AVAILABLE)

  // Pricing
  price                 Float
  pricePerSqft          Float?
  maintenanceCharges    Float?
  securityDeposit       Float?
  bookingAmount         Float?
  tokenAmount           Float?
  isNegotiable          Boolean                 @default(false)
  isPriceOnRequest      Boolean                 @default(false)

  // Specifications
  bedrooms              Int?
  bathrooms             Int?
  balconies             Int?
  floors                Int?
  totalFloors           Int?
  carpetArea            Float?
  builtUpArea           Float?
  superBuiltUpArea      Float?
  plotArea              Float?
  furnishingStatus      FurnishingStatus?
  facing                FacingDirection?
  parkingType           ParkingType?
  parkingCount          Int?

  // Additional Details
  age                   Int?                    // in years
  possessionDate        DateTime?
  possessionStatus      String?                 // Immediate, 1 Month, 3 Months
  reraId                String?
  videoUrl              String?
  virtualTourUrl        String?
  brochureUrl           String?
  floorPlanUrl          String?
  isOwnerProperty       Boolean                 @default(false)
  isFeatured            Boolean                 @default(false)
  isVerified            Boolean                 @default(false)
  isPremium             Boolean                 @default(false)
  verifiedDate          DateTime?

  // Address
  address               String                  @db.Text
  landmark              String?
  latitude              Float?
  longitude             Float?
  googleMapUrl          String?

  // Owner/Contact Details
  ownerName             String?
  contactNumber         String?
  contactEmail          String?
  whatsappNumber        String?

  // Legal & Documentation
  ownershipType         String?                 // Freehold, Leasehold, Co-operative
  approvedBy            String?                 // Municipal Corporation, etc.
  occupancyCertificate  Boolean                 @default(false)
  taxReceipts           Boolean                 @default(false)

  // SEO & Marketing
  metaTitle             String?
  metaDescription       String?                 @db.Text
  keywords              String[]

  // Counts & Analytics
  viewCount             Int                     @default(0)
  inquiryCount          Int                     @default(0)
  favoriteCount         Int                     @default(0)
  shareCount            Int                     @default(0)
  callCount             Int                     @default(0)

  // Timestamps
  publishedAt           DateTime?
  lastUpdatedAt         DateTime?
  expiresAt             DateTime?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt

  // Relations
  user                  User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  agent                 Agent?                  @relation(fields: [agentId], references: [id], onDelete: SetNull)
  project               Project?                @relation(fields: [projectId], references: [id], onDelete: SetNull)
  city                  City                    @relation(fields: [cityId], references: [id])
  locality              Locality                @relation(fields: [localityId], references: [id])
  
  images                PropertyImage[]
  amenities             PropertyAmenity[]
  favorites             Favorite[]
  inquiries             Inquiry[]
  reviews               Review[]
  appointments          Appointment[]

  @@index([cityId, localityId])
  @@index([propertyType, transactionType])
  @@index([price])
  @@index([approvalStatus, availabilityStatus])
  @@index([isFeatured, isPremium])
  @@index([userId])
  @@index([slug])
  @@map("properties")
}

model PropertyImage {
  id              String    @id @default(uuid())
  propertyId      String
  url             String
  caption         String?
  category        String?   // exterior, interior, bedroom, bathroom, kitchen, etc.
  orderIndex      Int       @default(0)
  isPrimary       Boolean   @default(false)
  createdAt       DateTime  @default(now())

  // Relations
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId, orderIndex])
  @@map("property_images")
}

// ==================== PROJECT MANAGEMENT ====================

model Project {
  id                    String          @id @default(uuid())
  cityId                String
  localityId            String

  // Basic Info
  name                  String
  slug                  String?         @unique
  description           String          @db.Text
  builderName           String          // Builder company name as text field
  builderContact        String?         // Builder contact number
  builderEmail          String?         // Builder email
  builderWebsite        String?         // Builder website
  projectStatus         ProjectStatus
  totalUnits            Int?
  availableUnits        Int?
  soldUnits             Int?
  totalTowers           Int?
  totalAcres            Float?
  totalFloors           Int?

  // Pricing
  priceRange            String?         // e.g., "45 Lac - 1.25 Cr"
  minPrice              Float?
  maxPrice              Float?

  // Details
  launchDate            DateTime?
  possessionDate        DateTime?
  completionDate        DateTime?
  reraNumber            String?
  reraWebsite           String?
  reraApprovalDate      DateTime?
  approvalAuthority     String?
  landArea              Float?          // in acres
  openArea              Float?          // percentage
  
  // Media
  logo                  String?
  brochureUrl           String?
  masterPlanUrl         String?
  videoUrl              String?
  virtualTourUrl        String?
  
  // Location
  address               String          @db.Text
  landmark              String?
  latitude              Float?
  longitude             Float?
  googleMapUrl          String?

  // Configuration Available
  configurations        String[]        // ["1 BHK", "2 BHK", "3 BHK"]
  
  // Features
  highlights            String[]
  specifications        Json?           // Flexible field for detailed specs
  bankApprovals         String[]        // List of approved banks
  
  // SEO
  metaTitle             String?
  metaDescription       String?         @db.Text
  keywords              String[]
  
  // Counts & Analytics
  viewCount             Int             @default(0)
  inquiryCount          Int             @default(0)
  favoriteCount         Int             @default(0)
  shareCount            Int             @default(0)

  // Status
  isActive              Boolean         @default(true)
  isFeatured            Boolean         @default(false)
  isPremium             Boolean         @default(false)
  isVerified            Boolean         @default(false)
  
  // Timestamps
  publishedAt           DateTime?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  // Relations
  city                  City            @relation(fields: [cityId], references: [id])
  locality              Locality        @relation(fields: [localityId], references: [id])
  
  images                ProjectImage[]
  amenities             ProjectAmenity[]
  floorPlans            FloorPlan[]
  properties            Property[]
  reviews               Review[]

  @@index([cityId, localityId])
  @@index([projectStatus])
  @@index([isFeatured, isPremium])
  @@index([slug])
  @@map("projects")
}

model ProjectImage {
  id              String    @id @default(uuid())
  projectId       String
  url             String
  caption         String?
  category        String?   // exterior, interior, amenities, location, floor_plan
  orderIndex      Int       @default(0)
  isPrimary       Boolean   @default(false)
  createdAt       DateTime  @default(now())

  // Relations
  project         Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, orderIndex])
  @@map("project_images")
}

model FloorPlan {
  id              String    @id @default(uuid())
  projectId       String
  name            String    // e.g., "2 BHK - Type A"
  configuration   String    // "2 BHK", "3 BHK"
  carpetArea      Float?
  builtUpArea     Float?
  superBuiltUpArea Float?
  bedrooms        Int?
  bathrooms       Int?
  balconies       Int?
  imageUrl        String
  pdfUrl          String?
  price           Float?
  availableUnits  Int?
  description     String?   @db.Text
  createdAt       DateTime  @default(now())

  // Relations
  project         Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("floor_plans")
}

// ==================== AMENITIES ====================

model Amenity {
  id              String              @id @default(uuid())
  name            String              @unique
  icon            String?
  category        String              // Basic, Sports, Safety, Entertainment, etc.
  description     String?
  isActive        Boolean             @default(true)
  displayOrder    Int                 @default(0)
  createdAt       DateTime            @default(now())

  // Relations
  properties      PropertyAmenity[]
  projects        ProjectAmenity[]

  @@index([category])
  @@map("amenities")
}

model PropertyAmenity {
  id              String    @id @default(uuid())
  propertyId      String
  amenityId       String

  // Relations
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  amenity         Amenity   @relation(fields: [amenityId], references: [id], onDelete: Cascade)

  @@unique([propertyId, amenityId])
  @@map("property_amenities")
}
Hospital
model ProjectAmenity {
  id              String    @id @default(uuid())
  projectId       String
  amenityId       String

  // Relations
  project         Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  amenity         Amenity   @relation(fields: [amenityId], references: [id], onDelete: Cascade)

  @@unique([projectId, amenityId])
  @@map("project_amenities")
}

// ==================== USER INTERACTIONS ====================

model Favorite {
  id              String    @id @default(uuid())
  userId          String
  propertyId      String
  createdAt       DateTime  @default(now())

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@index([userId])
  @@map("favorites")
}

model Inquiry {
  id              String    @id @default(uuid())
  userId          String
  propertyId      String
  name            String
  email           String
  phone           String
  message         String    @db.Text
  interestedIn    String?   // site_visit, phone_call, details, schedule_meeting
  budget          String?
  financing       String?   // Self-funded, Home Loan Required
  moveInDate      String?   // Immediate, 1-3 months, 3-6 months
  status          String    @default("PENDING") // PENDING, CONTACTED, IN_PROGRESS, CLOSED, CONVERTED
  priority        String?   @default("MEDIUM") // LOW, MEDIUM, HIGH
  response        String?   @db.Text
  respondedAt     DateTime?
  respondedBy     String?
  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId, status])
  @@index([userId])
  @@index([status, priority])
  @@map("inquiries")
}

model Review {
  id              String    @id @default(uuid())
  userId          String
  propertyId      String?
  projectId       String?
  rating          Int       // 1-5
  title           String?
  comment         String?   @db.Text
  pros            String[]  // Positive points
  cons            String[]  // Negative points
  images          String[]
  isVerified      Boolean   @default(false)
  isApproved      Boolean   @default(false)
  verifiedPurchase Boolean  @default(false)
  helpfulCount    Int       @default(0)
  notHelpfulCount Int       @default(0)
  replyText       String?   @db.Text
  replyDate       DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  property        Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  project         Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([propertyId, isApproved])
  @@index([projectId, isApproved])
  @@index([rating])
  @@map("reviews")
}

model Appointment {
  id              String    @id @default(uuid())
  userId          String
  propertyId      String
  agentId         String?
  scheduledDate   DateTime
  scheduledTime   String
  name            String
  email           String
  phone           String
  message         String?   @db.Text
  appointmentType String?   // site_visit, video_call, phone_call
  status          String    @default("PENDING") // PENDING, CONFIRMED, COMPLETED, CANCELLED, NO_SHOW
  cancellationReason String? @db.Text
  notes           String?   @db.Text
  reminder1Sent   Boolean   @default(false)
  reminder2Sent   Boolean   @default(false)
  feedback        String?   @db.Text
  rating          Int?      // 1-5
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  agent           Agent?    @relation(fields: [agentId], references: [id], onDelete: SetNull)

  @@index([propertyId, status])
  @@index([userId])
  @@index([agentId, status])
  @@index([scheduledDate])
  @@map("appointments")
}

model SavedSearch {
  id              String    @id @default(uuid())
  userId          String
  name            String
  searchQuery     Json      // Store all search parameters
  notifyOnNew     Boolean   @default(true)
  frequency       String?   @default("DAILY") // INSTANT, DAILY, WEEKLY
  lastNotified    DateTime?
  matchCount      Int       @default(0)
  createdAt       DateTime  @default(now())

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("saved_searches")
}

// ==================== BLOG & CONTENT ====================

model Blog {
  id              String    @id @default(uuid())
  title           String
  slug            String    @unique
  content         String    @db.Text
  excerpt         String?   @db.Text
  featuredImage   String?
  category        String
  tags            String[]
  author          String
  authorImage     String?
  readTime        Int?      // in minutes
  viewCount       Int       @default(0)
  likeCount       Int       @default(0)
  shareCount      Int       @default(0)
  isPublished     Boolean   @default(false)
  isFeatured      Boolean   @default(false)
  metaTitle       String?
  metaDescription String?   @db.Text
  publishedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([slug])
  @@index([category])
  @@index([isPublished, isFeatured])
  @@map("blogs")
}

// ==================== SETTINGS & CONFIGURATION ====================

model SiteSetting {
  id              String    @id @default(uuid())
  key             String    @unique
  value           String    @db.Text
  category        String?   // general, email, sms, payment
  description     String?
  isPublic        Boolean   @default(false)
  updatedAt       DateTime  @updatedAt

  @@index([category])
  @@map("site_settings")
}

// ==================== NOTIFICATIONS ====================

model Notification {
  id              String    @id @default(uuid())
  userId          String
  title           String
  message         String    @db.Text
  type            String    // info, success, warning, error
  category        String?   // property, inquiry, appointment, system
  isRead          Boolean   @default(false)
  link            String?
  metadata        Json?
  createdAt       DateTime  @default(now())

  @@index([userId, isRead])
  @@index([createdAt])
  @@map("notifications")
}